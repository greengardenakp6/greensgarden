<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Checkout | Green Garden</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0f3d1a; --primary-light: #1b6b2b; --accent: #cfa364;
            --surface: rgba(255, 255, 255, 0.96); --text-main: #0a1f0f; --text-muted: #5a6d5e;
            --shadow-soft: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body { font-family: 'Inter', sans-serif; min-height: 100vh; background: #051008; color: var(--text-main); overflow-x: hidden; position: relative; }
        
        /* Animated Background */
        .bg-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: linear-gradient(135deg, #052e16 0%, #0a3818 50%, #051008 100%); overflow: hidden; }
        .bg-blob { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; animation: float 20s infinite; }
        .blob-1 { top: -10%; left: -10%; width: 600px; height: 600px; background: radial-gradient(circle, var(--primary-light), transparent); }
        .blob-2 { bottom: -20%; right: -10%; width: 500px; height: 500px; background: radial-gradient(circle, var(--accent), transparent); opacity: 0.2; animation-delay: -5s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(30px, -50px) scale(1.1); } }

        /* Navbar */
        .navbar { background: rgba(10, 31, 15, 0.8); backdrop-filter: blur(20px); padding: 1rem 3rem; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.1); position: sticky; top: 0; z-index: 100; }
        .back-btn { display: flex; align-items: center; gap: 10px; text-decoration: none; color: white; font-weight: 600; padding: 10px 20px; border-radius: 50px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; }
        .back-btn:hover { background: var(--accent); color: #000; }
        .brand { font-family: 'Playfair Display', serif; font-size: 1.4rem; color: white; }
        .secure-badge { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: rgba(255,255,255,0.7); }

        /* Layout */
        .container { display: grid; grid-template-columns: 1fr 1.2fr; gap: 40px; max-width: 1200px; margin: 0 auto; padding: 50px 30px; }

        /* Cards */
        .card { background: var(--surface); border-radius: 24px; box-shadow: var(--shadow-soft); padding: 35px; position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: linear-gradient(90deg, var(--primary), var(--accent)); }
        .section-title { font-family: 'Playfair Display', serif; font-size: 1.3rem; margin-bottom: 25px; display: flex; align-items: center; gap: 12px; color: var(--primary); }
        .section-title i { color: var(--accent); }

        /* Summary */
        .summary-item { display: flex; gap: 15px; padding: 15px 0; border-bottom: 1px solid rgba(0,0,0,0.04); }
        .summary-item img { width: 60px; height: 60px; object-fit: cover; border-radius: 12px; }
        .item-info h4 { font-size: 0.95rem; font-weight: 600; margin-bottom: 4px; }
        .item-price { margin-left: auto; font-weight: 700; color: var(--primary); }
        .totals-grid { margin-top: 25px; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 20px; }
        .total-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.95rem; color: var(--text-muted); }
        .total-final { font-size: 1.3rem; font-weight: 700; color: var(--text-main); font-family: 'Playfair Display', serif; }

        /* Form */
        .form-group { margin-bottom: 20px; position: relative; }
        .input-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #ccc; z-index: 2; pointer-events: none; }
        .form-input { width: 100%; padding: 16px 16px 16px 48px; border: 2px solid #f0f0f0; background: #fff; border-radius: 12px; font-size: 0.95rem; transition: all 0.3s; }
        .form-input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(15, 61, 26, 0.05); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        /* Payment */
        .payment-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 25px; }
        .payment-card { background: rgba(255,255,255,0.5); border: 2px solid #eee; border-radius: 12px; padding: 15px 10px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .payment-card.active { border-color: var(--primary); background: rgba(15, 61, 26, 0.05); }
        .payment-card i { font-size: 1.4rem; color: var(--primary); margin-bottom: 5px; display: block; }
        .payment-card span { font-weight: 600; font-size: 0.75rem; }
        .payment-details-box { max-height: 0; overflow: hidden; opacity: 0; transition: all 0.5s; background: #f9fafb; border-radius: 12px; }
        .payment-details-box.active { max-height: 300px; opacity: 1; margin-bottom: 20px; padding: 20px; border: 1px solid #eee; }

        /* Button */
        .btn-place-order { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 700; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; transition: all 0.3s; box-shadow: 0 15px 30px rgba(15, 61, 26, 0.3); }
        .btn-place-order:hover { transform: translateY(-3px); box-shadow: 0 20px 40px rgba(15, 61, 26, 0.4); }

        /* Mobile CTA */
        .floating-cta { position: fixed; bottom: 0; left: 0; width: 100%; padding: 20px 30px; background: rgba(255,255,255,0.98); backdrop-filter: blur(10px); box-shadow: 0 -10px 40px rgba(0,0,0,0.1); z-index: 90; display: flex; justify-content: space-between; align-items: center; transform: translateY(100%); transition: transform 0.4s ease; }
        .floating-cta.visible { transform: translateY(0); }

        /* Modal */
        .success-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 61, 26, 0.9); backdrop-filter: blur(10px); display: flex; justify-content: center; align-items: center; z-index: 200; opacity: 0; visibility: hidden; transition: all 0.4s; }
        .success-overlay.show { opacity: 1; visibility: visible; }
        .success-modal { background: white; padding: 40px; border-radius: 30px; text-align: center; max-width: 420px; width: 90%; transform: scale(0.8); transition: transform 0.5s; }
        .success-overlay.show .success-modal { transform: scale(1); }
        .success-icon { width: 80px; height: 80px; background: var(--primary); border-radius: 50%; display: flex; justify-content: center; align-items: center; margin: 0 auto 25px; color: white; font-size: 2rem; }

        @media (max-width: 900px) {
            .container { grid-template-columns: 1fr; padding: 20px; }
            .payment-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="bg-container">
        <div class="bg-blob blob-1"></div>
        <div class="bg-blob blob-2"></div>
    </div>

    <nav class="navbar">
        <a href="cart.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back</a>
        <div class="brand">Secure Checkout</div>
        <div class="secure-badge"><i class="fas fa-lock"></i> SSL Protected</div>
    </nav>

    <div class="container">
        <div class="card summary-card" style="animation: fadeIn 0.8s ease backwards;">
            <h3 class="section-title"><i class="fas fa-seedling"></i> Your Order</h3>
            <div id="summaryItems"></div>

            <label class="order-bump" onchange="toggleBump()" style="display:flex; align-items:center; gap:15px; background:rgba(207,163,100,0.08); border:1px solid rgba(207,163,100,0.3); border-radius:16px; padding:20px; margin:25px 0; cursor:pointer;">
                <input type="checkbox" id="bumpCheck" style="display:none;">
                <i class="fas fa-flask" style="font-size:1.5rem; color:var(--accent);"></i>
                <div style="flex:1;">
                    <h4 style="color:var(--primary); font-size:0.95rem; margin-bottom:2px; font-weight:700;">Add Premium Fertilizer</h4>
                    <p style="font-size:0.8rem; color:var(--text-muted);">Essential nutrients for growth.</p>
                </div>
                <div style="font-weight:700; color:var(--accent); font-size:1.1rem;">+₹199</div>
            </label>

            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <input type="text" id="promoInput" class="form-input" style="padding-left:15px;" placeholder="Promo Code">
                <button style="padding:0 20px; background:var(--primary); color:white; border:none; border-radius:8px; font-weight:600; cursor:pointer;" onclick="applyPromo()">Apply</button>
            </div>
            <div id="promoMsg" style="height: 20px; font-size:0.85rem; font-weight:600; margin-bottom:15px;"></div>

            <div class="totals-grid">
                <div class="total-row"><span>Subtotal</span><span id="subtotalDisplay">₹0</span></div>
                <div class="total-row" id="discountRow" style="display:none;"><span>Discount</span><span id="discountDisplay" style="color:var(--primary);">-₹0</span></div>
                <div class="total-row"><span>Shipping</span><span style="color: var(--primary); font-weight: 600;">FREE</span></div>
                <div class="total-row total-final"><span>Total</span><span id="totalDisplay">₹0</span></div>
            </div>
        </div>

        <div class="card form-card" style="animation: fadeIn 0.8s ease 0.2s backwards;">
            <div style="display:flex; justify-content:space-between; margin-bottom:30px; background:rgba(15,61,26,0.03); padding:15px; border-radius:12px;">
                <div style="display:flex; flex-direction:column; align-items:center; text-align:center; gap:6px; font-size:0.7rem; font-weight:700; color:var(--text-muted);"><i class="fas fa-shield-alt" style="color:var(--primary); font-size:1.2rem;"></i><span>Protection</span></div>
                <div style="display:flex; flex-direction:column; align-items:center; text-align:center; gap:6px; font-size:0.7rem; font-weight:700; color:var(--text-muted);"><i class="fas fa-undo" style="color:var(--primary); font-size:1.2rem;"></i><span>Guarantee</span></div>
                <div style="display:flex; flex-direction:column; align-items:center; text-align:center; gap:6px; font-size:0.7rem; font-weight:700; color:var(--text-muted);"><i class="fas fa-award" style="color:var(--primary); font-size:1.2rem;"></i><span>Quality</span></div>
            </div>

            <div>
                <h3 class="section-title"><i class="fas fa-truck"></i> Shipping Details</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <input type="text" id="full-name" class="form-input" placeholder="Full Name" required>
                        <i class="fas fa-user input-icon"></i>
                    </div>
                    <div class="form-group">
                        <input type="tel" id="phone" class="form-input" placeholder="Phone Number" required>
                        <i class="fas fa-phone-alt input-icon"></i>
                    </div>
                </div>
                <div class="form-group">
                    <input type="text" id="address" class="form-input" placeholder="Delivery Address" required>
                    <i class="fas fa-map-marker-alt input-icon"></i>
                </div>
            </div>

            <div style="margin-top: 30px;">
                <h3 class="section-title"><i class="fas fa-wallet"></i> Payment Method</h3>
                <div class="payment-grid">
                    <div class="payment-card" onclick="selectPayment('creditcard', this)"><i class="fas fa-credit-card"></i><span>Card</span></div>
                    <div class="payment-card" onclick="selectPayment('upi', this)"><i class="fas fa-qrcode"></i><span>UPI</span></div>
                    <div class="payment-card" onclick="selectPayment('netbanking', this)"><i class="fas fa-university"></i><span>Bank</span></div>
                    <div class="payment-card" onclick="selectPayment('cod', this)"><i class="fas fa-money-bill-wave"></i><span>COD</span></div>
                </div>

                <div id="payment-fields">
                    <div id="creditcard-fields" class="payment-details-box">
                        <div class="form-group"><input type="text" id="card-number" class="form-input" placeholder="Card Number" maxlength="19"><i class="fas fa-credit-card input-icon"></i></div>
                        <div class="grid-2">
                            <div class="form-group"><input type="text" id="card-expiry" class="form-input" placeholder="MM/YY" maxlength="5"><i class="fas fa-calendar input-icon"></i></div>
                            <div class="form-group"><input type="password" id="card-cvv" class="form-input" placeholder="CVV" maxlength="4"><i class="fas fa-lock input-icon"></i></div>
                        </div>
                    </div>
                    <div id="upi-fields" class="payment-details-box">
                        <div class="form-group"><input type="text" id="upi-id" class="form-input" placeholder="Enter UPI ID (name@upi)"><i class="fas fa-at input-icon"></i></div>
                    </div>
                    <div id="netbanking-fields" class="payment-details-box">
                        <div class="form-group">
                            <select id="bank-name" class="form-input" style="padding-left: 48px; cursor: pointer;">
                                <option value="">Select Bank</option>
                                <option value="SBI">State Bank of India</option>
                                <option value="HDFC">HDFC Bank</option>
                            </select>
                            <i class="fas fa-university input-icon"></i>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn-place-order" id="placeOrderBtn" onclick="placeOrder()">
                <span>Pay Securely</span> <i class="fas fa-lock"></i>
            </button>
        </div>
    </div>

    <div class="floating-cta" id="floatingCta">
        <div>
            <span style="font-size: 0.8rem; color: #777; display:block;">Total Payable</span>
            <span id="floatingTotal" style="font-size:1.2rem; font-weight:800; color:var(--primary);">₹0</span>
        </div>
        <button class="btn-place-order" style="width:auto; padding:12px 30px; margin:0;" onclick="document.getElementById('placeOrderBtn').click()">Pay Now</button>
    </div>

    <div id="successModal" class="success-overlay">
        <div class="success-modal">
            <div class="success-icon"><i class="fas fa-check"></i></div>
            <h2 style="font-family:'Playfair Display'; font-size:1.8rem; margin-bottom:10px; color:var(--primary);">Order Confirmed!</h2>
            <p style="color:var(--text-muted); margin-bottom:20px;">Your plants are getting ready for their journey.</p>
            <p style="font-weight: 700; margin-bottom: 20px;">Order ID: <span id="orderIdDisplay" style="color: var(--accent);">#ORD12345</span></p>
            <button onclick="window.location.href='home.html'" style="width:100%; padding:14px; background:var(--primary); color:white; border:none; border-radius:10px; cursor:pointer; font-weight:700;">Back to Home</button>
        </div>
    </div>
    <style>@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }</style>

    <script>
        let cartItems = [];
        let selectedPayment = null;
        let subtotal = 0;
        let discount = 0;
        let bumpAdded = false;
        const BUMP_PRICE = 199;

        document.addEventListener('DOMContentLoaded', () => {
            loadCart();
            setupInputMasking();
            setupFloatingCTA();
            loadSavedForm();
        });

        function loadCart() {
            cartItems = JSON.parse(localStorage.getItem('cart')) || [];
            const container = document.getElementById('summaryItems');
            container.innerHTML = '';
            subtotal = 0;

            if (cartItems.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#777; padding: 40px 20px; grid-column: 1/-1;">Your cart is empty. <a href="products.html" style="color:var(--primary)">Shop now</a></p>';
                document.getElementById('placeOrderBtn').disabled = true;
                return;
            }

            cartItems.forEach(item => {
                let priceNum = item.priceNumber || parseFloat(item.price.replace(/[^0-9.]/g, '')) || 0;
                subtotal += priceNum * (item.quantity || 1);

                const div = document.createElement('div');
                div.className = 'summary-item';
                div.innerHTML = `
                    <img src="${item.image || 'https://via.placeholder.com/60'}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/60'">
                    <div class="item-info"><h4>${item.name}</h4><p>Qty: ${item.quantity || 1}</p></div>
                    <div class="item-price">₹${priceNum.toLocaleString()}</div>`;
                container.appendChild(div);
            });
            updateTotals();
        }

        function toggleBump() {
            bumpAdded = !bumpAdded;
            const label = document.querySelector('.order-bump');
            label.style.background = bumpAdded ? 'rgba(207, 163, 100, 0.15)' : 'rgba(207, 163, 100, 0.08)';
            updateTotals();
        }

        function applyPromo() {
            const code = document.getElementById('promoInput').value.toUpperCase();
            const msg = document.getElementById('promoMsg');
            if (code === 'GREEN10') {
                discount = Math.round(subtotal * 0.10);
                msg.innerHTML = '<i class="fas fa-check-circle"></i> Code Applied!';
                msg.style.color = 'var(--primary)';
                document.getElementById('discountRow').style.display = 'flex';
            } else {
                discount = 0;
                msg.innerHTML = '<i class="fas fa-times-circle"></i> Invalid Code';
                msg.style.color = '#e74c3c';
                document.getElementById('discountRow').style.display = 'none';
            }
            updateTotals();
        }

        function updateTotals() {
            let total = subtotal + (bumpAdded ? BUMP_PRICE : 0);
            let finalTotal = total - discount;
            document.getElementById('subtotalDisplay').textContent = `₹${total.toLocaleString()}`;
            document.getElementById('discountDisplay').textContent = `-₹${discount.toLocaleString()}`;
            document.getElementById('totalDisplay').textContent = `₹${finalTotal.toLocaleString()}`;
            const ft = document.getElementById('floatingTotal');
            if(ft) ft.textContent = `₹${finalTotal.toLocaleString()}`;
        }

        function selectPayment(method, element) {
            selectedPayment = method;
            document.querySelectorAll('.payment-card').forEach(c => c.classList.remove('active'));
            element.classList.add('active');
            document.querySelectorAll('.payment-details-box').forEach(d => d.classList.remove('active'));
            const box = document.getElementById(method + '-fields');
            if(box) box.classList.add('active');
        }

        function validateForm() {
            const name = document.getElementById("full-name").value;
            const phone = document.getElementById("phone").value;
            const address = document.getElementById("address").value;
            if (!name || !phone || !address) { alert("Please fill in all shipping details."); return false; }
            if (phone.length < 10) { alert("Please enter a valid phone number."); return false; }
            return true;
        }

        function placeOrder() {
            if(!validateForm()) return;
            if (!selectedPayment) { alert("Please select a payment method."); return; }
            
            const btn = document.getElementById('placeOrderBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            
            setTimeout(() => {
                const orderId = "ORD" + Math.floor(Math.random() * 100000);
                document.getElementById('orderIdDisplay').innerText = orderId;
                
                const order = {
                    id: orderId,
                    items: cartItems,
                    total: document.getElementById('totalDisplay').textContent,
                    date: new Date().toISOString(),
                    status: "Processing",
                    customer: { name: document.getElementById("full-name").value, address: document.getElementById("address").value }
                };
                let orders = JSON.parse(localStorage.getItem("orders")) || [];
                orders.push(order);
                localStorage.setItem("orders", JSON.stringify(orders));
                localStorage.removeItem('cart');

                document.getElementById('successModal').classList.add('show');
                btn.innerHTML = '<i class="fas fa-check"></i> Done';
            }, 2000);
        }

        function setupInputMasking() {
            document.getElementById('phone').addEventListener('input', (e) => e.target.value = e.target.value.replace(/\D/g, '').substring(0, 10));
            document.getElementById('card-number').addEventListener('input', (e) => {
                let x = e.target.value.replace(/\D/g, '').match(/(\d{0,4})(\d{0,4})(\d{0,4})(\d{0,4})/);
                e.target.value = x[1] + (x[2] ? ' ' + x[2] : '') + (x[3] ? ' ' + x[3] : '') + (x[4] ? ' ' + x[4] : '');
            });
        }

        function loadSavedForm() {
            const inputs = document.querySelectorAll('.form-input');
            inputs.forEach(input => {
                const key = `gg_${input.id}`;
                if(localStorage.getItem(key)) input.value = localStorage.getItem(key);
                input.addEventListener('input', () => localStorage.setItem(key, input.value));
            });
        }

        function setupFloatingCTA() {
            const btn = document.getElementById('placeOrderBtn');
            const floatingCta = document.getElementById('floatingCta');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    floatingCta.classList.toggle('visible', !entry.isIntersecting);
                });
            }, { threshold: 0.1 });
            observer.observe(btn);
        }
    </script>
</body>
</html>
