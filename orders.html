<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders | Green Garden</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #0f3d1a; --accent: #cfa364; --text-main: #1a1a1a; --text-muted: #666; --surface: #ffffff; --bg: #f4f7f6; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; min-height: 100vh; background: var(--bg); position: relative; }
        body::before { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(#1b6b2b 1px, transparent 1px); background-size: 40px 40px; opacity: 0.03; z-index: -1; }

        /* Navbar */
        .navbar { background: var(--surface); padding: 1.2rem 3rem; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.03); position: sticky; top: 0; z-index: 100; }
        .back-btn { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--text-main); font-weight: 600; padding: 10px 20px; border-radius: 50px; background: #f5f5f5; transition: all 0.3s; }
        .back-btn:hover { background: var(--primary); color: white; }
        .navbar-title { font-family: 'Playfair Display', serif; font-size: 1.6rem; color: var(--primary); }

        /* Toolbar */
        .toolbar { background: var(--surface); padding: 20px; border-radius: 16px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 5px 20px rgba(0,0,0,0.02); }
        .filter-group { display: flex; gap: 10px; }
        .filter-btn { padding: 8px 18px; border-radius: 20px; border: 1px solid #eee; background: #fff; color: var(--text-muted); font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.2s; }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* Order Card */
        .order-card { background: var(--surface); border-radius: 16px; border: 1px solid #eee; box-shadow: 0 5px 15px rgba(0,0,0,0.02); margin-bottom: 20px; overflow: hidden; transition: transform 0.3s; }
        .order-card:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .order-header { padding: 20px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f0f0f0; background: #fafafa; }
        .order-meta h3 { font-family: 'Playfair Display', serif; font-size: 1.2rem; color: var(--primary); margin-bottom: 4px; }
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
        .status-processing { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .status-shipped { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .status-delivered { background: rgba(16, 185, 129, 0.1); color: #10b981; }

        .order-body { padding: 20px 25px; }
        .order-item { display: flex; gap: 15px; margin-bottom: 15px; }
        .order-item img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; }
        
        .order-footer { padding: 15px 25px; background: #fafafa; border-top: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .order-total { font-family: 'Playfair Display', serif; font-size: 1.1rem; font-weight: 700; }
        .btn-icon { padding: 8px 15px; border-radius: 8px; border: 1px solid #eee; background: white; color: var(--text-muted); font-size: 0.85rem; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px; font-weight: 600; }
        .btn-icon:hover { background: var(--primary); color: white; border-color: var(--primary); }

        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; background: white; border-radius: 16px; border: 1px solid #eee; }
        .empty-state i { font-size: 3rem; color: var(--accent); opacity: 0.5; margin-bottom: 15px; }

        @media (max-width: 768px) {
            .toolbar { flex-direction: column; gap: 15px; }
            .order-footer { flex-direction: column; gap: 15px; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="home.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back</a>
        <div class="navbar-title">My Orders</div>
        <div style="width: 100px;"></div>
    </nav>

    <div style="max-width: 1000px; margin: 0 auto; padding: 40px 20px;">
        <div class="toolbar">
            <div class="filter-group">
                <button class="filter-btn active" onclick="filterOrders('all', event)">All</button>
                <button class="filter-btn" onclick="filterOrders('Processing', event)">Processing</button>
                <button class="filter-btn" onclick="filterOrders('Shipped', event)">Shipped</button>
                <button class="filter-btn" onclick="filterOrders('Delivered', event)">Delivered</button>
            </div>
            <div style="position:relative;">
                <i class="fas fa-search" style="position:absolute; left:15px; top:50%; transform:translateY(-50%); color:#ccc;"></i>
                <input type="text" placeholder="Search Order ID..." id="searchInput" onkeyup="searchOrders()" style="padding:10px 15px 10px 40px; border-radius:8px; border:1px solid #eee; font-family:inherit;">
            </div>
        </div>

        <div id="ordersContainer"></div>
    </div>

    <script>
        // 1. DATA INIT
        if (!localStorage.getItem('orders')) {
            const demoOrders = [
                { orderId: "ORD84521", date: new Date(Date.now() - 86400000).toISOString(), status: "Shipped", items: [{name: "Winter Daisy Red Mixed Seed", price: "Rs. 150", image: "https://via.placeholder.com/60", quantity: 1}], total: "Rs. 150", paymentMethod: "UPI", customer: { name: "Demo User", address: "123 Garden St" } },
                { orderId: "ORD12345", date: new Date().toISOString(), status: "Processing", items: [{name: "Bitter Gourd - Karela Seed", price: "Rs. 99", image: "https://via.placeholder.com/60", quantity: 1}], total: "Rs. 99", paymentMethod: "COD", customer: { name: "Demo User", address: "123 Garden St" } }
            ];
            localStorage.setItem('orders', JSON.stringify(demoOrders));
        }

        let orders = JSON.parse(localStorage.getItem('orders')) || [];

        // 2. RENDER
        function renderOrders(data) {
            const container = document.getElementById('ordersContainer');
            container.innerHTML = '';
            const sortedData = [...data].sort((a, b) => new Date(b.date) - new Date(a.date));

            if (sortedData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-box-open"></i>
                        <h3 style="font-family:'Playfair Display'; color:var(--primary); margin-top:10px;">No Orders Found</h3>
                        <p style="margin-top:5px; color:#777;">Looks like you haven't placed any orders yet.</p>
                        <a href="products.html" class="btn-icon" style="margin-top:20px; text-decoration:none; background:var(--primary); color:white; border-color:var(--primary);">Start Shopping</a>
                    </div>`;
                return;
            }

            sortedData.forEach((order, index) => {
                const statusClass = order.status.toLowerCase();
                const card = document.createElement('div');
                card.className = 'order-card';
                
                const itemsHtml = order.items.map(item => `
                    <div class="order-item">
                        <img src="${item.image || 'https://via.placeholder.com/60'}" alt="${item.name}">
                        <div style="flex:1;">
                            <h4 style="font-size:0.95rem; font-weight:600;">${item.name}</h4>
                            <p style="font-size:0.85rem; color:var(--text-muted);">${item.price} x ${item.quantity || 1}</p>
                        </div>
                    </div>
                `).join('');

                card.innerHTML = `
                    <div class="order-header">
                        <div>
                            <h3>#${order.orderId}</h3>
                            <span style="font-size:0.85rem; color:var(--text-muted);">${new Date(order.date).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' })}</span>
                        </div>
                        <div class="status-badge status-${statusClass}">${order.status}</div>
                    </div>
                    <div class="order-body">${itemsHtml}</div>
                    <div class="order-footer">
                        <div class="order-total">Total: ${order.total}</div>
                        <div style="display:flex; gap:10px;">
                            <button class="btn-icon" onclick="downloadInvoice('${order.orderId}')"><i class="fas fa-file-pdf"></i> Invoice</button>
                            <button class="btn-icon" onclick="alert('Tracking feature coming soon!')"><i class="fas fa-truck"></i> Track</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // 3. ACTIONS
        function downloadInvoice(orderId) {
            try {
                if (typeof window.jspdf === 'undefined') { alert("Error: PDF Library failed to load."); return; }
                const { jsPDF } = window.jspdf;
                const order = orders.find(o => o.orderId === orderId);
                if (!order) return;

                const doc = new jsPDF();
                doc.setFontSize(22); doc.setTextColor(23, 78, 30); doc.text("Green Garden", 105, 20, null, null, "center");
                doc.setFontSize(10); doc.setTextColor(150); doc.text("Premium Plants & Garden Essentials", 105, 28, null, null, "center");
                doc.setDrawColor(23, 78, 30); doc.line(20, 35, 190, 35);

                doc.setFontSize(12); doc.setTextColor(0);
                doc.text(`Invoice: #${order.orderId}`, 20, 45);
                doc.text(`Date: ${new Date(order.date).toLocaleDateString()}`, 20, 52);
                
                doc.text("Bill To:", 20, 75);
                doc.setTextColor(100);
                if(order.customer) { doc.text(order.customer.name || "Guest", 20, 82); doc.text(order.customer.address || "N/A", 20, 89); }
                else { doc.text("Guest", 20, 82); }

                doc.setTextColor(0); doc.setFillColor(240, 240, 240); doc.rect(20, 100, 170, 10, 'F');
                doc.text("Item", 22, 107); doc.text("Price", 160, 107);

                let y = 117;
                order.items.forEach(item => {
                    doc.text(item.name, 22, y);
                    doc.text(item.price, 160, y);
                    y += 10;
                });

                doc.setFontSize(14); doc.setTextColor(23, 78, 30); doc.text(`Total: ${order.total}`, 160, y + 10);
                doc.save(`Invoice_${order.orderId}.pdf`);
            } catch (error) { alert("Failed to generate invoice."); }
        }

        // 4. FILTER & SEARCH
        function filterOrders(status, e) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            if(e && e.target) e.target.classList.add('active');
            let filtered = status === 'all' ? orders : orders.filter(o => o.status === status);
            renderOrders(filtered);
        }

        function searchOrders() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            renderOrders(orders.filter(o => o.orderId.toLowerCase().includes(query)));
        }

        // Init
        renderOrders(orders);
    </script>
</body>
</html>
